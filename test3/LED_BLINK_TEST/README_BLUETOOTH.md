# STM32F4 Bluetooth Module Integration Guide

This project includes UART and SPI configurations that would be generated by CubeMX for integrating Bluetooth modules with your STM32F4 microcontroller.

## Hardware Configuration

### UART Configuration
- **USART1**: PA9 (TX), PA10 (RX) - 115200 baud
- **USART2**: PA2 (TX), PA3 (RX) - 9600 baud (for Bluetooth modules)

### SPI Configuration
- **SPI1**: PA5 (SCK), PA6 (MISO), PA7 (MOSI), PA4 (CS) - Fast speed
- **SPI2**: PB13 (SCK), PB14 (MISO), PB15 (MOSI), PB12 (CS) - Medium speed

## Supported Bluetooth Modules

### 1. HC-05/HC-06 (UART-based)
- **Connection**: Use USART2 (PA2/PA3)
- **Baud Rate**: 9600 (configurable)
- **Protocol**: AT commands

#### Usage Example:
```c
// Initialize HC-05
BT_HC05_Init();

// Send message
BT_SendMessage("Hello from STM32!\r\n");

// Receive message
uint8_t buffer[256];
uint16_t received = BT_ReceiveMessage(buffer, 256);
```

### 2. nRF24L01 (SPI-based)
- **Connection**: Use SPI1 (PA5-PA7, PA4 as CS)
- **Protocol**: SPI communication

#### Usage Example:
```c
// Configure nRF24L01
SPI_nRF24L01_Example();

// Send data
uint8_t data[] = {0x01, 0x02, 0x03, 0x04};
SPI_SendData(data, 4);

// Receive data
uint8_t received[4];
SPI_ReceiveData(received, 4);
```

### 3. ESP32 (UART-based)
- **Connection**: Use USART1 (PA9/PA10)
- **Baud Rate**: 115200
- **Protocol**: AT commands or custom protocol

## Pin Connections

### For HC-05/HC-06:
```
STM32F4    HC-05/HC-06
PA2 (TX) → RX
PA3 (RX) ← TX
3.3V     → VCC
GND      → GND
```

### For nRF24L01:
```
STM32F4    nRF24L01
PA5 (SCK) → SCK
PA6 (MISO)← MISO
PA7 (MOSI)→ MOSI
PA4 (CS)  → CSN
3.3V      → VCC
GND       → GND
```

## AT Commands for HC-05

### Basic Commands:
- `AT` - Test connection
- `AT+VERSION` - Get firmware version
- `AT+NAME=STM32_BT` - Set device name
- `AT+PSWD=1234` - Set pairing password
- `AT+UART=9600,0,0` - Set UART parameters

### Configuration Sequence:
```c
void BT_HC05_Init(void)
{
  BT_SendCommand("AT\r\n");
  HAL_Delay(1000);
  
  BT_SendCommand("AT+NAME=STM32_BT\r\n");
  HAL_Delay(1000);
  
  BT_SendCommand("AT+PSWD=1234\r\n");
  HAL_Delay(1000);
  
  BT_SendCommand("AT+UART=9600,0,0\r\n");
  HAL_Delay(1000);
}
```

## SPI Communication

### Basic SPI Functions:
```c
// Send data
void SPI_SendData(uint8_t* data, uint16_t size)
{
  HAL_GPIO_WritePin(GPIOA, GPIO_PIN_4, GPIO_PIN_RESET); // CS low
  HAL_SPI_Transmit(&hspi1, data, size, 1000);
  HAL_GPIO_WritePin(GPIOA, GPIO_PIN_4, GPIO_PIN_SET);   // CS high
}

// Receive data
void SPI_ReceiveData(uint8_t* data, uint16_t size)
{
  HAL_GPIO_WritePin(GPIOB, GPIO_PIN_12, GPIO_PIN_RESET); // CS low
  HAL_SPI_Receive(&hspi2, data, size, 1000);
  HAL_GPIO_WritePin(GPIOB, GPIO_PIN_12, GPIO_PIN_SET);   // CS high
}
```

## Troubleshooting

### Common Issues:

1. **No response from Bluetooth module**
   - Check wiring connections
   - Verify baud rate settings
   - Ensure module is powered correctly

2. **SPI communication errors**
   - Check CS pin connections
   - Verify SPI mode (CPOL, CPHA)
   - Check clock frequency settings

3. **Compilation errors**
   - Ensure all header files are included
   - Check that HAL libraries are properly linked

## Next Steps

1. **Connect your Bluetooth module** according to the pin diagrams above
2. **Compile and flash** the code to your STM32F4
3. **Test communication** using the provided example functions
4. **Customize the code** for your specific application needs

## Additional Resources

- [STM32 HAL UART Documentation](https://www.st.com/resource/en/user_manual/dm00105879.pdf)
- [STM32 HAL SPI Documentation](https://www.st.com/resource/en/user_manual/dm00105879.pdf)
- [HC-05 AT Command Set](https://www.itead.cc/wiki/Serial_to_Bluetooth)
- [nRF24L01 Datasheet](https://www.nordicsemi.com/Products/Low-power-short-range-wireless/nRF24-series) 